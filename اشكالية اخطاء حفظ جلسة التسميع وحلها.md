# ุฅุดูุงููุฉ ุฃุฎุทุงุก ุญูุธ ุฌูุณุฉ ุงูุชุณููุน ูุญููุง

## ๐ ูุตู ุงููุดููุฉ

### ุงููุถุน ุงูุญุงูู (ุงููุดูู):
ุนูุฏ ุงูุชูุงุก ุงููุนูู ูู ุฌูุณุฉ ุงูุชุณููุน ููุชุงุจุฉ ุงูููุงุญุธุงุช ูุงูุถุบุท ุนูู "ุญูุธ ุงููุชุงุฆุฌ"ุ ุฅุฐุง ุญุฏุซ ุฎุทุฃ ูู ุงูุฅุฑุณุงู (ุงููุทุงุน ุงููุชุ ูุดููุฉ ูู ุงูุฎุงุฏูุ ุฅูุฎ)ุ ูุฅู:

1. **ุงููุงูุฐุฉ ุชูุบูู ุชููุงุฆูุงู** ุญุชู ูู ูุดู ุงูุญูุธ
2. **ุงููุนูู ูุนูุฏ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ** ุฏูู ูุนุฑูุฉ ูุชูุฌุฉ ุงูุนูููุฉ
3. **ููุฏุงู ุงูููุงุญุธุงุช ูุงูุจูุงูุงุช** ุงููุฏุฎูุฉ
4. **ุนุฏู ูุฌูุฏ ุฎูุงุฑ ูุฅุนุงุฏุฉ ุงููุญุงููุฉ**

## ๐ ุชุญููู ุงูููุฏ ุงูุญุงูู

### ุงูุฌุฒุก ุงููุดูู ูู `handleSaveResults`:
```javascript
const handleSaveResults = async () => {
  // ... ุชุญุถูุฑ ุงูุจูุงูุงุช
  
  try {
    const response = await updateRecitationSession(currentSessionId, updateData);
    console.log('โ ุชู ุญูุธ ุงููุชุงุฆุฌ ุจูุฌุงุญ:', response);
    
  } catch (error) {
    console.error('โ ุฎุทุฃ ูู ุญูุธ ุงููุชุงุฆุฌ:', error);
    setApiError('ุญุฏุซ ุฎุทุฃ ูู ุญูุธ ุงููุชุงุฆุฌ. ุณุชุชู ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ.');
    
  } finally {
    // โ ูุฐุง ุงูุฌุฒุก ูุชููุฐ ุญุชู ูู ูุดู ุงูุญูุธ!
    setIsSavingResults(false);
    setShowScoreDialog(false);  // ุฅุบูุงู ุงููุงูุฐุฉ
    setIsSessionActive(false);
    navigate('/students');      // ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
  }
};
```

### โ ุงููุดุงูู:
1. **`finally` block ูุชููุฐ ุฏุงุฆูุงู** - ุญุชู ุนูุฏ ูุดู ุงูุนูููุฉ
2. **`setShowScoreDialog(false)` ูู finally** - ูุบูู ุงููุงูุฐุฉ ุญุชู ูู ูุดู ุงูุญูุธ
3. **`navigate('/students')` ูู finally** - ูููู ุงููุนูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
4. **ุฑุณุงูุฉ ุงูุฎุทุฃ ุชุธูุฑ ูู ุงูุตูุญุฉ ุงูุฌุฏูุฏุฉ** ูููุณ ูู ุงููุงูุฐุฉ ุงูุญุงููุฉ

## ๐ฏ ุงูุญู ุงููุทููุจ

### ุงูุณููู ุงููุทููุจ:
1. **ูู ุญุงูุฉ ุงููุฌุงุญ:**
   - ุฅุบูุงู ุงููุงูุฐุฉ
   - ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
   - ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ (ุงุฎุชูุงุฑู)

2. **ูู ุญุงูุฉ ุงููุดู:**
   - **ุงูุงุญุชูุงุธ ุจุงููุงูุฐุฉ ููุชูุญุฉ**
   - ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุฏุงุฎู ุงููุงูุฐุฉ
   - ุงูุงุญุชูุงุธ ุจุฌููุน ุงูุจูุงูุงุช ุงููุฏุฎูุฉ (ุงูููุงุญุธุงุชุ ุงููุชูุฌุฉ)
   - ุฅุชุงุญุฉ ุฎูุงุฑ "ุฅุนุงุฏุฉ ุงููุญุงููุฉ"

## ๐๏ธ ุทุฑููุฉ ุงูุญู

### 1. ุชุนุฏูู `handleSaveResults`:
```javascript
const handleSaveResults = async () => {
  setIsSavingResults(true);
  setApiError(null); // ูุณุญ ุฃู ุฎุทุฃ ุณุงุจู
  
  try {
    const response = await updateRecitationSession(currentSessionId, updateData);
    console.log('โ ุชู ุญูุธ ุงููุชุงุฆุฌ ุจูุฌุงุญ:', response);
    
    // โ ุงููุฌุงุญ: ุฅุบูุงู ุงููุงูุฐุฉ ูุงูุนูุฏุฉ
    setShowScoreDialog(false);
    setIsSessionActive(false);
    navigate('/students');
    
  } catch (error) {
    console.error('โ ุฎุทุฃ ูู ุญูุธ ุงููุชุงุฆุฌ:', error);
    
    // โ ุงููุดู: ุนุฑุถ ุฎุทุฃ ุฏุงุฎู ุงููุงูุฐุฉ ูุงูุงุญุชูุงุธ ุจูุง ููุชูุญุฉ
    setApiError('ูุดู ูู ุญูุธ ุงููุชุงุฆุฌ. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช ูุญุงูู ูุฑุฉ ุฃุฎุฑู.');
    // ุงููุงูุฐุฉ ุชุจูู ููุชูุญุฉ - ูุง ูุณุชุฏุนู setShowScoreDialog(false)
    
  } finally {
    setIsSavingResults(false); // ุฅููุงู ูุคุดุฑ ุงูุชุญููู ููุท
  }
};
```

### 2. ุฅุถุงูุฉ ุนุฑุถ ุงูุฎุทุฃ ุฏุงุฎู ุงููุงูุฐุฉ:
```jsx
<DialogContent>
  {/* ุนุฑุถ ุฑุณุงูุฉ ุงูุฎุทุฃ ุฅุฐุง ูุฌุฏุช */}
  {apiError && (
    <Alert 
      severity="error" 
      sx={{ mb: 3 }}
      action={
        <Button 
          color="inherit" 
          size="small" 
          onClick={() => setApiError(null)}
        >
          ุฅุบูุงู
        </Button>
      }
    >
      {apiError}
    </Alert>
  )}
  
  {/* ุจุงูู ูุญุชูู ุงููุงูุฐุฉ */}
</DialogContent>
```

### 3. ุชุญุณูู ุฒุฑ ุงูุญูุธ:
```jsx
<Button 
  onClick={handleSaveResults} 
  variant="contained" 
  color="primary"
  startIcon={isSavingResults ? <CircularProgress size={16} /> : <SaveIcon />}
  disabled={isSavingResults}
  fullWidth
>
  {isSavingResults ? "ุฌุงุฑู ุงูุญูุธ..." : 
   apiError ? "ุฅุนุงุฏุฉ ุงููุญุงููุฉ" : "ุญูุธ ุงููุชุงุฆุฌ ูุงูุนูุฏุฉ"}
</Button>
```

## ๐ฎ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุงูุณููุงุฑูู ุงููุงุฌุญ:
```
ุงููุนูู ูููู ุงูุชุณููุน โ ููุชุจ ุงูููุงุญุธุงุช โ ูุถุบุท "ุญูุธ ุงููุชุงุฆุฌ"
โ (ูุฌุญ ุงูุฅุฑุณุงู)
ุงููุงูุฐุฉ ุชูุบูู โ ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
```

### ุงูุณููุงุฑูู ุงููุงุดู:
```
ุงููุนูู ูููู ุงูุชุณููุน โ ููุชุจ ุงูููุงุญุธุงุช โ ูุถุบุท "ุญูุธ ุงููุชุงุฆุฌ"
โ (ุงููุทุงุน ุงููุช)
ุฑุณุงูุฉ ุฎุทุฃ ูู ุงููุงูุฐุฉ: "ูุดู ูู ุญูุธ ุงููุชุงุฆุฌ..."
ุงููุงูุฐุฉ ุชุจูู ููุชูุญุฉ โ ุงูููุงุญุธุงุช ูุญููุธุฉ โ ุฒุฑ "ุฅุนุงุฏุฉ ุงููุญุงููุฉ"
```

## ๐ง ุงูุชุญุณููุงุช ุงูุฅุถุงููุฉ ุงูููุชุฑุญุฉ

### 1. ุงูุญูุธ ุงููุญูู (Local Storage):
```javascript
// ุญูุธ ุงูุจูุงูุงุช ูุญููุงู ูุจู ุงูุฅุฑุณุงู
const sessionData = {
  sessionId: currentSessionId,
  notes,
  finalScore,
  errors,
  timestamp: Date.now()
};
localStorage.setItem('unsaved_session', JSON.stringify(sessionData));

// ูุณุญ ุงูุจูุงูุงุช ุงููุญููุฉ ุนูุฏ ุงููุฌุงุญ
localStorage.removeItem('unsaved_session');
```

### 2. ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ:
```javascript
const MAX_RETRIES = 3;
let retryCount = 0;

const handleSaveWithRetry = async () => {
  while (retryCount < MAX_RETRIES) {
    try {
      await updateRecitationSession(currentSessionId, updateData);
      return; // ูุฌุญ
    } catch (error) {
      retryCount++;
      if (retryCount < MAX_RETRIES) {
        await new Promise(resolve => setTimeout(resolve, 2000)); // ุงูุชุธุงุฑ 2 ุซุงููุฉ
      } else {
        throw error; // ูุดู ููุงุฆูุงู
      }
    }
  }
};
```

### 3. ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู:
```javascript
const [isOnline, setIsOnline] = useState(navigator.onLine);

useEffect(() => {
  const handleOnline = () => setIsOnline(true);
  const handleOffline = () => setIsOnline(false);
  
  window.addEventListener('online', handleOnline);
  window.addEventListener('offline', handleOffline);
  
  return () => {
    window.removeEventListener('online', handleOnline);
    window.removeEventListener('offline', handleOffline);
  };
}, []);
```

## ๐ ุชุฃุซูุฑ ุงูุญู

### ูุจู ุงูุฅุตูุงุญ:
- โ ููุฏุงู ุงูุจูุงูุงุช ุนูุฏ ูุดู ุงูุฅุฑุณุงู
- โ ุนุฏู ูุนุฑูุฉ ุงููุนูู ุจูุชูุฌุฉ ุงูุนูููุฉ
- โ ุถุฑูุฑุฉ ุฅุนุงุฏุฉ ุงูุชุณููุน ูู ุงูุตูุฑ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุงุญุชูุงุธ ุจุงูุจูุงูุงุช ุนูุฏ ุงููุดู
- โ ูุถูุญ ูู ูุนุฑูุฉ ูุชูุฌุฉ ุงูุนูููุฉ
- โ ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฏูู ููุฏุงู
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ูุฃูุซุฑ ุฃูุงูุงู

## ๐ ุงูุฎูุงุตุฉ

ูุฐู ุงูุฅุดูุงููุฉ ุญุฑุฌุฉ ูุฃููุง ุชุคุซุฑ ุนูู:
1. **ููุซูููุฉ ุงููุธุงู** - ุนุฏู ุถูุงู ุญูุธ ุงูุจูุงูุงุช
2. **ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู** - ุฅุญุจุงุท ุงููุนูููู
3. **ููุฏุงู ุงูุจูุงูุงุช** - ุถูุงุน ุฌูุฏ ุงูุชุณููุน ูุงูููุงุญุธุงุช

ุงูุญู ุงูููุชุฑุญ ุจุณูุท ููููู ูุนุงู ูู ุถูุงู ุนุฏู ููุฏุงู ุงูุจูุงูุงุช ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจุดูู ูุจูุฑ.

---
*ุชุงุฑูุฎ ุงูุฅูุดุงุก: ุฏูุณูุจุฑ 2024*
*ุงูุญุงูุฉ: ุฌุงูุฒ ููุชุทุจูู*
