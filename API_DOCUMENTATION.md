# توثيق API شامل للمعلمين والطلاب والحلقات

## نظرة عامة
هذا الدليل يوضح جميع نقاط النهاية (Endpoints) المتاحة في API للنظام الشامل لإدارة المعلمين والطلاب والحلقات باللغة العربية.

## البنية الأساسية
- **Base URL**: `/api`
- **Content-Type**: `application/json`
- **Accept**: `application/json`
- **اللغة**: العربية

## استجابة موحدة
جميع الاستجابات تتبع النمط التالي:
```json
{
    "نجح": true/false,
    "رسالة": "نص الرسالة",
    "البيانات": {},
    "معلومات_الصفحة": {} // فقط للاستعلامات المقسمة
}
```

---

## 1. APIs المعلمين

### 1.1 قائمة المعلمين
**GET** `/api/teachers`

**المعاملات (Query Parameters):**
- `mosque_id` (اختياري): معرف المسجد
- `is_active` (اختياري): حالة النشاط (true/false)
- `search` (اختياري): البحث بالاسم
- `per_page` (اختياري): عدد العناصر في الصفحة (افتراضي: 15)
- `page` (اختياري): رقم الصفحة

**مثال على الطلب:**
```bash
GET /api/teachers?mosque_id=1&is_active=true&search=أحمد&per_page=10
```

**مثال على الاستجابة:**
```json
{
    "نجح": true,
    "رسالة": "تم جلب قائمة المعلمين بنجاح",
    "البيانات": [
        {
            "id": 1,
            "الاسم": "أحمد محمد علي",
            "البريد_الإلكتروني": "ahmed@email.com",
            "رقم_الهاتف": "0501234567",
            "رقم_الهوية": "1234567890",
            "المسجد": "مسجد النور",
            "نشط": "نعم",
            "تاريخ_التعيين": "2023-01-15",
            "عدد_الحلقات": 3,
            "عدد_الطلاب": 45,
            "إجمالي_الراتب": 5000,
            "تاريخ_الانضمام": "2023-01-15 10:30"
        }
    ],
    "معلومات_الصفحة": {
        "الصفحة_الحالية": 1,
        "إجمالي_الصفحات": 5,
        "إجمالي_العناصر": 67,
        "عناصر_الصفحة": 15
    }
}
```

### 1.2 تفاصيل معلم محدد
**GET** `/api/teachers/{id}`

**مثال على الطلب:**
```bash
GET /api/teachers/1
```

### 1.3 حلقات معلم محدد
**GET** `/api/teachers/{id}/circles`

### 1.4 إحصائيات معلم محدد
**GET** `/api/teachers/{id}/stats`

### 1.5 سجل حضور معلم محدد
**GET** `/api/teachers/{id}/attendance`

**المعاملات:**
- `start_date` (اختياري): تاريخ البداية (YYYY-MM-DD)
- `end_date` (اختياري): تاريخ النهاية (YYYY-MM-DD)
- `month` (اختياري): الشهر (1-12)
- `year` (اختياري): السنة
- `per_page` (اختياري): عدد العناصر في الصفحة

### 1.6 رواتب وحوافز معلم محدد
**GET** `/api/teachers/{id}/financials`

**المعاملات:**
- `year` (اختياري): السنة

---

## 2. APIs الطلاب

### 2.1 قائمة الطلاب
**GET** `/api/students`

**المعاملات:**
- `mosque_id` (اختياري): معرف المسجد
- `circle_id` (اختياري): معرف الحلقة
- `teacher_id` (اختياري): معرف المعلم
- `is_active` (اختياري): حالة النشاط
- `search` (اختياري): البحث بالاسم أو رقم الطالب
- `per_page` (اختياري): عدد العناصر في الصفحة

**مثال على الاستجابة:**
```json
{
    "نجح": true,
    "رسالة": "تم جلب قائمة الطلاب بنجاح",
    "البيانات": [
        {
            "id": 1,
            "الاسم": "محمد أحمد سالم",
            "رقم_الطالب": "STU001",
            "البريد_الإلكتروني": "student@email.com",
            "رقم_الهاتف": "0501234567",
            "تاريخ_الميلاد": "2010-05-15",
            "المسجد": "مسجد النور",
            "نشط": "نعم",
            "الحلقات": [
                {
                    "id": 1,
                    "الاسم": "حلقة المبتدئين",
                    "المستوى": "ابتدائي",
                    "المعلم": "أحمد محمد علي"
                }
            ],
            "المنهج_الحالي": {
                "السورة": "البقرة",
                "الآية": "50",
                "الصفحات_المحفوظة": 25
            },
            "آخر_تقدم": {
                "تاريخ_الجلسة": "2024-01-20",
                "الصفحات_المحفوظة": 2,
                "درجة_الجودة": 85
            },
            "تاريخ_التسجيل": "2023-09-01 14:30"
        }
    ]
}
```

### 2.2 تفاصيل طالب محدد
**GET** `/api/students/{id}`

### 2.3 منهج طالب محدد
**GET** `/api/students/{id}/curriculum`

**مثال على الاستجابة:**
```json
{
    "نجح": true,
    "رسالة": "تم جلب منهج الطالب بنجاح",
    "اسم_الطالب": "محمد أحمد سالم",
    "رقم_الطالب": "STU001",
    "المنهج_الحالي": {
        "السورة_الحالية": "البقرة",
        "الآية_الحالية": "50",
        "الصفحة_الحالية": "8",
        "الصفحات_المحفوظة": 25,
        "إجمالي_الصفحات": 604,
        "نسبة_الإنجاز": 4.14,
        "تاريخ_آخر_تحديث": "2024-01-20 16:45"
    },
    "تقدم_الأجزاء": [
        {
            "رقم_الجزء": 1,
            "اسم_الجزء": "الجزء 1",
            "الصفحات_المحفوظة": 20,
            "إجمالي_الصفحات": 20,
            "نسبة_الإنجاز": 100.0,
            "مكتمل": "نعم"
        }
    ],
    "إحصائيات_التقدم": {
        "متوسط_الصفحات_الأسبوعية": 2.5,
        "متوسط_درجة_الجودة": 82.5,
        "إجمالي_جلسات_التقدم": 15,
        "الأجزاء_المكتملة": 1
    }
}
```

### 2.4 إحصائيات طالب محدد
**GET** `/api/students/{id}/stats`

### 2.5 سجل حضور طالب محدد
**GET** `/api/students/{id}/attendance`

### 2.6 جلسات تسميع طالب محدد
**GET** `/api/students/{id}/recitation-sessions`

**المعاملات:**
- `start_date` (اختياري): تاريخ البداية
- `end_date` (اختياري): تاريخ النهاية
- `min_quality` (اختياري): الحد الأدنى لدرجة الجودة
- `per_page` (اختياري): عدد العناصر في الصفحة

---

## 3. APIs الحلقات

### 3.1 قائمة الحلقات
**GET** `/api/circles`

**المعاملات:**
- `mosque_id` (اختياري): معرف المسجد
- `teacher_id` (اختياري): معرف المعلم
- `grade_level` (اختياري): المستوى
- `is_active` (اختياري): حالة النشاط
- `search` (اختياري): البحث بالاسم
- `per_page` (اختياري): عدد العناصر في الصفحة

### 3.2 تفاصيل حلقة محددة
**GET** `/api/circles/{id}`

### 3.3 إحصائيات حلقة محددة
**GET** `/api/circles/{id}/stats`

### 3.4 حلقات معلم محدد
**GET** `/api/circles/teacher/{teacherId}`

### 3.5 أفضل الحلقات من حيث الأداء
**GET** `/api/circles/top-performing`

**المعاملات:**
- `limit` (اختياري): عدد الحلقات المطلوبة (افتراضي: 10)

---

## 4. APIs التقارير والإحصائيات

### 4.1 الإحصائيات العامة للنظام
**GET** `/api/reports/general-stats`

**مثال على الاستجابة:**
```json
{
    "نجح": true,
    "رسالة": "تم جلب الإحصائيات العامة بنجاح",
    "الإحصائيات_العامة": {
        "المعلمين": {
            "إجمالي_المعلمين": 25,
            "المعلمين_النشطين": 23,
            "المعلمين_غير_النشطين": 2,
            "متوسط_عدد_الحلقات_لكل_معلم": 2.4
        },
        "الطلاب": {
            "إجمالي_الطلاب": 450,
            "الطلاب_النشطين": 420,
            "الطلاب_غير_النشطين": 30,
            "متوسط_العمر": 12.5
        },
        "الحلقات": {
            "إجمالي_الحلقات": 60,
            "الحلقات_النشطة": 55,
            "الحلقات_غير_النشطة": 5,
            "متوسط_عدد_الطلاب_لكل_حلقة": 7.5
        },
        "التسميع": {
            "إجمالي_الجلسات": 1250,
            "متوسط_الجودة": 78.5,
            "إجمالي_الصفحات_المسمعة": 3400,
            "نسبة_النجاح": 82.4
        }
    },
    "تاريخ_التقرير": "2024-01-20 15:30:45"
}
```

### 4.2 تقرير الأداء الشهري
**GET** `/api/reports/monthly-performance`

**المعاملات:**
- `year` (اختياري): السنة (افتراضي: السنة الحالية)
- `month` (اختياري): الشهر (افتراضي: الشهر الحالي)

### 4.3 إحصائيات المساجد
**GET** `/api/reports/mosque-stats`

---

## 5. APIs المصادقة والحضور والتسميع (موجودة مسبقاً)

### 5.1 المصادقة
- `POST /api/auth/teacher/login` - تسجيل دخول المعلم
- `POST /api/auth/student/login` - تسجيل دخول الطالب
- `POST /api/auth/teacher/change-password` - تغيير كلمة مرور المعلم
- `POST /api/auth/student/change-password` - تغيير كلمة مرور الطالب
- `POST /api/auth/user-info` - معلومات المستخدم

### 5.2 الحضور
- `POST /api/attendance/record` - تسجيل حضور
- `GET /api/attendance/records` - سجلات الحضور
- `GET /api/attendance/stats` - إحصائيات الحضور

### 5.3 التسميع
- `POST /api/recitation/sessions` - إنشاء جلسة تسميع
- `GET /api/recitation/sessions` - عرض جلسات التسميع
- `GET /api/recitation/sessions/{sessionId}` - تفاصيل جلسة محددة
- `PUT /api/recitation/sessions/{sessionId}` - تحديث جلسة
- `GET /api/recitation/sessions/stats/summary` - إحصائيات عامة
- `GET /api/recitation/sessions/stats/student/{studentId}` - إحصائيات طالب
- `GET /api/recitation/sessions/stats/teacher/{teacherId}` - إحصائيات معلم

### 5.4 أخطاء التسميع
- `POST /api/recitation/errors` - إضافة أخطاء
- `GET /api/recitation/errors` - عرض الأخطاء
- `GET /api/recitation/errors/stats/common` - الأخطاء الشائعة
- `GET /api/recitation/errors/stats/student/{studentId}` - أخطاء طالب

---

## 6. رموز الاستجابة

- **200**: نجح الطلب
- **400**: خطأ في البيانات المرسلة
- **404**: العنصر غير موجود
- **500**: خطأ خادم داخلي

---

## 7. أمثلة على الاستخدام

### مثال 1: جلب قائمة المعلمين في مسجد محدد
```bash
curl -X GET "http://localhost:8000/api/teachers?mosque_id=1&per_page=5" \
  -H "Accept: application/json" \
  -H "Content-Type: application/json"
```

### مثال 2: جلب تفاصيل طالب محدد
```bash
curl -X GET "http://localhost:8000/api/students/15" \
  -H "Accept: application/json"
```

### مثال 3: جلب أفضل الحلقات
```bash
curl -X GET "http://localhost:8000/api/circles/top-performing?limit=5" \
  -H "Accept: application/json"
```

### مثال 4: جلب تقرير شهري
```bash
curl -X GET "http://localhost:8000/api/reports/monthly-performance?year=2024&month=1" \
  -H "Accept: application/json"
```

---

## 8. ملاحظات مهمة

1. **التصفح**: معظم نقاط النهاية تدعم التصفح باستخدام `page` و `per_page`
2. **الفلترة**: يمكن تطبيق فلاتر متعددة في نفس الطلب
3. **التواريخ**: يجب إرسال التواريخ بصيغة `YYYY-MM-DD`
4. **الأرقام**: جميع المعرفات يجب أن تكون أرقام صحيحة موجبة
5. **اللغة**: جميع النصوص والرسائل باللغة العربية
6. **الأداء**: API محسن للأداء مع استخدام Eager Loading
7. **معالجة الأخطاء**: جميع الأخطاء تُرجع رسائل واضحة باللغة العربية

---

## 9. اتصل بنا

لأي استفسارات أو اقتراحات حول API، يرجى التواصل مع فريق التطوير.
